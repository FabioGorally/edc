(()=>{"use strict";function e(){var e,s;return null!==(e=window.LOGGED_IN_USER_DATA)&&void 0!==e?e:null===(s=localStorage.getItem("__hivesdk-v2-loggedInUserData"))?null:JSON.parse(s)}var s=function(e){var s=this;this.logMessages=e,this.listen=function(e){var n=function(n){var r=n.data;s.isSdkRequest(r)&&(s.logMessages&&console.log("HIVE SDK LOGGING - message recieved from parent window:",r),e(r))};window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent&&window.attachEvent("onmessage",n,!1)},this.send=function(e,n,r){s.logMessages&&console.log("HIVE SDK LOGGING - sending message to parent window:",{messageType:e,eventId:n,data:r}),window.parent.postMessage({messageType:e,eventId:n,data:r,isHiveMessage:!0},"*")},this.isSdkRequest=function(e){return!!(null==e?void 0:e.isHiveMessage)}};function n(n){var r=document.getElementById("iframe-helper-js"),t=Number(r.dataset.tourId),a=r.dataset.sdkHostPageUrl,i=r.dataset.userDataJsonString,o=r.dataset.initEventId,d="debugMessages"in r.dataset,u=i?JSON.parse(i):e(),g=new s(d);g.listen(n);var c,p={tourId:t};return u&&(p.user=((c=u).signedLoginToken,function(e,s){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&s.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var t=0;for(r=Object.getOwnPropertySymbols(e);t<r.length;t++)s.indexOf(r[t])<0&&Object.prototype.propertyIsEnumerable.call(e,r[t])&&(n[r[t]]=e[r[t]])}return n}(c,["signedLoginToken"]))),g.send("initSuccess",o,p),{tourId:t,sdkHostPageUrl:a,userData:u,responseBroker:g}}let r=window.$,t=window.FB;r((function(){const{tourId:s,sdkHostPageUrl:a,userData:i,responseBroker:o}=n((function(n){if("fbSignup"===n.messageType){var i=n.eventId;if(void 0===t)return c("There was an error logging you in with Facebook. If you have an ad blocker installed, please disable it and try again.");function c(e){o.send("fbSignupError",i,e)}t.login((function(e){e.authResponse?r.ajax({type:"POST",url:"/api/jssdk/signup/fb/",data:{tourId:s,accessToken:e.authResponse.accessToken,sdkHostPageUrl:a},success(e){d(e.user_data),o.send("fbSignupSuccess",i,{user:e.user_data})},error(e){var s;if(e&&e.responseJSON){var n=e.responseJSON;if(s=n.msg,"login_redirect_required"===n.error_code)return void u(s,n.login_url,n.logout_url)}c(s)}}):c()}),{scope:"email,public_profile"})}else if("emailSignup"===n.messageType){i=n.eventId;var g=n.data;r.ajax({type:"POST",url:"/api/jssdk/signup/",data:{tourId:s,sdkHostPageUrl:a,email:g.email,didOptIn:g.didOptIn,skipResubscribing:g.skipResubscribing,firstName:g.firstName,lastName:g.lastName,phoneNumber:g.phoneNumber,didSmsOptIn:g.didSmsOptIn,birthday:g.birthday,birthdayNoYear:g.birthdayNoYear,locationString:g.location,mailingAddress:g.mailingAddress,country:g.country,city:g.city,state:g.state,zipCode:g.zipCode,signupWidgetId:g.swid},success(e){d(e.user_data),o.send("emailSignupSuccess",i,{user:e.user_data})},error(e){var s;if(e&&e.responseJSON){var n=e.responseJSON;if(s=n.msg,"login_redirect_required"===n.error_code)return void u(n.msg,n.login_url,n.logout_url)}o.send("emailSignupError",i,s)}})}else"phoneNumberSignup"===n.messageType?(i=n.eventId,g=n.data,r.ajax({type:"POST",url:"/api/jssdk/signup/",data:{tourId:s,sdkHostPageUrl:a,firstName:g.firstName,lastName:g.lastName,phoneNumber:g.phoneNumber,didSmsOptIn:g.didSmsOptIn,birthday:g.birthday,birthdayNoYear:g.birthdayNoYear,locationString:g.location,mailingAddress:g.mailingAddress,country:g.country,city:g.city,state:g.state,zipCode:g.zipCode,signupWidgetId:g.swid},success(e){d(e.user_data),o.send("phoneNumberSignupSuccess",i,{user:e.user_data})},error(e){var s;if(e&&e.responseJSON){var n=e.responseJSON;if(s=n.msg,"login_redirect_required"===n.error_code)return void u(n.msg,n.login_url,n.logout_url)}o.send("phoneNumberSignupError",i,s)}})):"trackPageView"===n.messageType?r.ajax({type:"POST",url:"/api/jssdk/tracking/pageview/",data:{pageUrl:n.data.pageUrl,referrerUrl:n.data.referrerUrl,timeViewed:n.data.timeViewed,tourId:s,signedLoginToken:e().signedLoginToken}}):"trackEvent"===n.messageType?(i=n.eventId,r.ajax({type:"POST",url:"/api/jssdk/tracking/event/",data:{tourId:s,eventType:n.data.eventType,eventData:n.data.eventData,timestamp:n.data.timestamp,signedLoginToken:e().signedLoginToken},success(e){o.send("trackEventSuccess",i)},error(e){var s;e&&e.responseJSON&&(s=e.responseJSON.msg),o.send("trackEventError",i,s)}})):"addToSegment"===n.messageType?(i=n.eventId,r.ajax({type:"POST",url:"/api/jssdk/segment/",data:{tourId:s,segmentName:n.data.segmentName,signedLoginToken:e().signedLoginToken},success(e){o.send("addToSegmentSuccess",i)},error(e){var s;e&&e.responseJSON&&(s=e.responseJSON.msg),o.send("addToSegmentError",i,s)}})):"removeFromSegment"===n.messageType?(i=n.eventId,r.ajax({type:"DELETE",url:"/api/jssdk/segment/",data:{tourId:s,segmentName:n.data.segmentName,signedLoginToken:e().signedLoginToken},success(e){o.send("removeFromSegmentSuccess",i)},error(e){var s;e&&e.responseJSON&&(s=e.responseJSON.msg),o.send("removeFromSegmentError",i,s)}})):"unsubscribe"===n.messageType&&function(e,s,n,r,t){var a=r,i=a.eventId,o=a.data,d=o.unsubscribeType,u=o.timestamp;e.ajax({type:"POST",url:"/api/jssdk/unsubscribe/",data:{tourId:s,unsubscribeType:d,timestampMilliseconds:u,signedLoginToken:n},success:function(){return t("unsubscribeSuccess",i)},error:function(e){var s;return t("unsubscribeError",i,null===(s=null==e?void 0:e.responseJSON)||void 0===s?void 0:s.msg)}})}(r,s,e().signedLoginToken,n,o.send)}));function d(e){var s;s=e,window.LOGGED_IN_USER_DATA=s,function(e,s){try{localStorage.setItem("__hivesdk-v2-loggedInUserData",JSON.stringify(s))}catch(e){}}(0,s),o.send("userLoggedInSuccess",null,{userData:e})}function u(e,s,n){var r=n+"?next_url="+encodeURIComponent(s+"?next="+encodeURIComponent(a));alert(e),top.location=r}window.LOGGED_IN_USER_DATA=i,window.LOGGED_IN_USER_DATA&&d(window.LOGGED_IN_USER_DATA)}))})();